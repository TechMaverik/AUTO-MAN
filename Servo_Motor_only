#define S1_PIN 13
#define S2_PIN 12
#define S3_PIN 14
#define S4_PIN 27
#define S5_PIN 26
#define S6_PIN 25

#include <ESP32Servo.h>
#include <ServoEasing.hpp>

ServoEasing servos[6];

int homePos[6] = {90, 90, 90, 90, 90, 90};

void setup() {
  Serial.begin(115200);
 
  servos[0].attach(S1_PIN, 90);
  servos[1].attach(S2_PIN, 90);
  servos[2].attach(S3_PIN, 90);
  servos[3].attach(S4_PIN, 90);
  servos[4].attach(S5_PIN, 90);
  servos[5].attach(S6_PIN, 90);
 
  for (int i = 0; i < 6; i++) {
    servos[i].setEasingType(EASE_CUBIC_IN_OUT);
    servos[i].setSpeed(120);
  }
 
  servos[0].easeTo(homePos[0]);
  servos[1].easeTo(homePos[1]);
  servos[2].easeTo(homePos[2]);
  servos[3].easeTo(homePos[3]);
  servos[4].easeTo(homePos[4]);
  servos[5].easeTo(homePos[5]);
 
  while (servos[0].isMoving() || servos[1].isMoving() || servos[2].isMoving() ||
         servos[3].isMoving() || servos[4].isMoving() || servos[5].isMoving()) {
    delay(20);
  }
}

void moveToPos(int pos[6], int speedOverride = 0) {
  for (int i = 0; i < 6; i++) {
    if (speedOverride > 0) servos[i].setSpeed(speedOverride);
    servos[i].easeTo(pos[i]);
  }
  while (servos[0].isMoving() || servos[1].isMoving() || servos[2].isMoving() ||
         servos[3].isMoving() || servos[4].isMoving() || servos[5].isMoving()) {
    delay(20);
  }
}

void loop() {
  int leanBack[6] = {110, 70, 120, 60, 90, 90};
  moveToPos(leanBack, 150);
  delay(500);
 
  int kick[6] = {110, 70, 120, 20, 90, 90};
  moveToPos(kick, 200);
  delay(300);
  moveToPos(leanBack, 200);
 
  for(int i = 0; i < 4; i++) {
    int shake1[6] = {110, 70, 120, 60, 120, 60};
    moveToPos(shake1, 150);
    int shake2[6] = {110, 70, 60, 60, 60, 120};
    moveToPos(shake2, 150);
  }
 
  int moon1[6] = {70, 110, 90, 120, 60, 90};
  moveToPos(moon1, 100);
  moveToPos(homePos, 150);
 
  delay(1000);
}
